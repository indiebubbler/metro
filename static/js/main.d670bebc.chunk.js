(this.webpackJsonpmetro=this.webpackJsonpmetro||[]).push([[0],{109:function(e,t,a){e.exports=a(193)},114:function(e,t,a){},115:function(e,t,a){},193:function(e,t,a){"use strict";a.r(t);var s=a(1),r=a.n(s),n=a(12),i=a.n(n),l=(a(114),a(115),a(21)),o=a(17),p=a.n(o),c=a(194),m=a(195),h=a(203);class d extends s.Component{render(){return r.a.createElement(c.a,{className:"pane "+this.props.className},r.a.createElement(m.a,{className:"pane-title"},this.props.title),r.a.createElement(m.a,{className:"pane-body"},this.props.children))}}var u=d;d.defaultProps={title:"title",children:[],className:""};var g=a(101);const b="by_bar",y="by_time",k="set_time",v="constant",S="stop",f="repeat",E="continue",C={TABLA:{key:"tabla",label:"Tabla"},ELECTRO_KIT:{key:"electrokit",label:"Electronic Kit"},METRONOME:{key:"metronome",label:"Metronome"},BASIC_DRUM_KIT:{key:"basicdrumkit",label:"Basic Drum Kit"},YAMAHA_RX5:{key:"yamaha_rx5",label:"Yamaha RX 5"}},w=[{file:"dha-slide.wav",label:"Dha",instrumentKey:"tabla"},{file:"dhin-slide.wav",label:"Dhin",instrumentKey:"tabla"},{file:"tin.wav",label:"Tin",instrumentKey:"tabla"},{file:"Kick.wav",label:"Kick",instrumentKey:"electrokit"},{file:"Snare.wav",label:"Snare",instrumentKey:"electrokit"},{file:"HiHat.wav",label:"Hi Hat",instrumentKey:"electrokit"},{file:"tap.wav",label:"Tap",instrumentKey:"metronome"},{file:"down.wav",label:"Down",instrumentKey:"metronome"},{file:"up.wav",label:"Up",instrumentKey:"metronome"},{file:"Kick.wav",label:"Kick",instrumentKey:"basicdrumkit"},{file:"Snare.wav",label:"Snare",instrumentKey:"basicdrumkit"},{file:"ClosedHat.wav",label:"Closed Hat",instrumentKey:"basicdrumkit"},{file:"OpenHat.wav",label:"Open Hat",instrumentKey:"basicdrumkit"},{file:"Kick.wav",label:"Kick",instrumentKey:"yamaha_rx5"},{file:"Rim.wav",label:"Rim",instrumentKey:"yamaha_rx5"},{file:"Ride.wav",label:"Ride",instrumentKey:"yamaha_rx5"},{file:"Cowbell.wav",label:"Cowbell",instrumentKey:"yamaha_rx5"},{file:"Shaker.wav",label:"Shaker",instrumentKey:"yamaha_rx5"}],M={};Object.keys(C).map((function(e,t){return M[C[e].key]=C[e],!0}));Object.keys(C).map(e=>C[e]);const B=[{isHeader:!0,title:"Basic"},{title:"Metronome 2/4",bpmStep:20,bpmRange:[100,200],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:60,byBarInterval:2,constantBpmSlider:300,interval:300,track:[[2],[1]],instrumentKey:"metronome"},{title:"Metronome 4/4",instrumentKey:C.METRONOME.key,playMode:y,byTimeInterval:60,bpmStep:20,bpmRange:[100,200],track:[[2],[1],[1],[1]]},{title:"Metronome 3/4",instrumentKey:C.METRONOME.key,playMode:y,byTimeInterval:60,bpmStep:20,bpmRange:[100,200],track:[[2],[1],[1]]},{isHeader:!0,title:"Drum Patterns"},{title:"Levee Break",instrumentKey:"electrokit",bpmRange:[300,400],track:[[0,2],[0],[2],[],[1,2],[],[2],[0],[2],[],[0,2],[0],[1,2],[],[2],[]],playMode:b,playbackMode:S,byTimeInterval:5,byBarInterval:10,stepsNum:10,bpmStep:10,isHidden:!0},{bpmStep:10,bpmRange:[300,400],currentBpm:300,playbackMode:"stop",playMode:"by_bar",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:5,byBarInterval:10,constantBpmSlider:300,track:[[0,2],[],[0,2],[],[2,1],[],[0,2],[],[2,0],[],[2,0],[],[1,2],[],[2,0],[]],instrumentKey:"electrokit",title:"Basic Rock"},{bpmStep:10,bpmRange:[300,400],currentBpm:300,playbackMode:"stop",playMode:"by_bar",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:5,byBarInterval:10,constantBpmSlider:300,track:[[0,2],[],[2],[],[2,1],[],[2],[0,2],[2,0],[],[0,2],[],[1,2],[],[2,0],[]],instrumentKey:"electrokit",title:"Impeach the President"},{bpmStep:10,bpmRange:[350,600],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:60,byBarInterval:10,constantBpmSlider:300,track:[[0,2],[2],[0,2],[2],[2,1],[2],[0,2],[3,1],[2],[2,1],[0,2],[2,1],[2,1],[0,3],[2],[2,1]],instrumentKey:"basicdrumkit",title:"Funky Drummer"},{bpmStep:10,bpmRange:[300,400],currentBpm:300,playbackMode:"stop",playMode:"by_bar",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:5,byBarInterval:10,constantBpmSlider:300,track:[[0,2],[],[2],[],[1,2],[],[2],[0],[2,0],[],[0,2],[],[1,2],[],[2],[]],instrumentKey:"electrokit",title:"Walk This Way"},{bpmStep:10,bpmRange:[300,400],currentBpm:300,playbackMode:"stop",playMode:"by_bar",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:5,byBarInterval:10,constantBpmSlider:300,track:[[0,2],[],[2,0],[],[1,2],[],[2],[],[2],[],[0,2],[0],[1,2],[],[2],[0]],instrumentKey:"electrokit",title:"It's a New Day"},{bpmStep:10,bpmRange:[300,400],currentBpm:300,playbackMode:"stop",playMode:"by_bar",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:5,byBarInterval:10,constantBpmSlider:300,track:[[0],[],[],[0],[1,2],[],[0],[],[0],[],[],[],[1,2],[],[],[]],instrumentKey:"electrokit",title:"The Big Beat"},{bpmStep:20,bpmRange:[300,500],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:50,constantBpmSlider:300,interval:120,track:[[0,2],[],[0,2],[],[1,2],[],[0,2],[],[0,2],[],[0,2],[],[1,2],[],[0,2],[]],instrumentKey:"basicdrumkit",title:"Rock"},{bpmStep:20,bpmRange:[528,600],currentBpm:300,playbackMode:"stop",playMode:"constant",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:50,constantBpmSlider:600,interval:120,track:[[0],[],[3],[],[1,0],[],[3],[],[0],[2],[3],[],[1,0],[],[0,3],[]],instrumentKey:"basicdrumkit",title:"Techno"},{bpmStep:20,bpmRange:[528,600],currentBpm:300,playbackMode:"stop",playMode:"constant",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:50,constantBpmSlider:400,interval:120,track:[[0,2],[],[2],[],[1,2],[],[2],[0],[2],[],[0,2],[],[1,2],[0],[2],[0]],instrumentKey:"basicdrumkit",title:"Hip Hop"},{isHeader:!0,title:"Afro-Cuban"},{bpmStep:20,bpmRange:[400,600],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:2,constantBpmSlider:300,interval:120,track:[[0,1,2],[2],[2],[0,1,2],[2,0],[2],[1,2],[0,2],[0,2],[2],[1,2],[0,2],[1,2,0],[2],[2],[0,2]],instrumentKey:"yamaha_rx5",title:"Son Clave"},{bpmStep:20,bpmRange:[400,600],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:2,constantBpmSlider:300,track:[[0,1,2],[2],[2],[0,1,2],[2,0],[2],[2],[0,2,1],[0,2],[2],[2,1],[0,2],[2,0,1],[2],[2],[0,2]],instrumentKey:"yamaha_rx5",title:"Rumba"},{bpmStep:20,bpmRange:[400,600],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:2,constantBpmSlider:300,track:[[0,1,2],[2],[2],[0,1,2],[2,0],[2],[2,1],[0,2],[0,2],[2],[2,1],[0,2],[2,0],[2,1],[2],[0,2]],instrumentKey:"yamaha_rx5",title:"Bossa Nova"},{bpmStep:20,bpmRange:[400,600],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:2,constantBpmSlider:300,track:[[0,1,3],[],[],[1,3],[0],[],[1,3],[],[0,1],[3],[3],[1],[0],[],[0,1],[]],instrumentKey:"yamaha_rx5",title:"Soukous"},{bpmStep:20,bpmRange:[400,600],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:2,constantBpmSlider:300,track:[[0,3],[],[1],[1,3],[0],[],[1,3],[1],[0],[],[3,1],[1],[0],[],[0,1,3],[1]],instrumentKey:"yamaha_rx5",title:"Gahu"},{bpmStep:20,bpmRange:[400,600],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:120,byBarInterval:2,constantBpmSlider:300,track:[[0,3],[],[1],[1],[0,3],[],[1,3,0],[1],[0],[],[3,1],[1],[0,3],[],[0,1],[1]],instrumentKey:"yamaha_rx5",title:"Shiko"},{isHeader:!0,title:"Polyrhythms"},{title:"3 over 4",bpmStep:20,bpmRange:[100,200],currentBpm:100,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:60,constantBpmSlider:300,track:[[1,0,0,0],[0,1,1],[1,1,1,1],[0,0,0,0]],timeSignature:4,instrumentKey:"basicdrumkit"},{bpmStep:20,bpmRange:[100,200],currentBpm:300,playbackMode:"stop",playMode:"by_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:60,byBarInterval:2,constantBpmSlider:300,track:[[1,1,0],[0,0,1],[1,1,1,1],[0,0,0]],timeSignature:3,instrumentKey:"basicdrumkit",title:"4 over 3"},{bpmStep:20,bpmRange:[121,359],currentBpm:300,playbackMode:"stop",playMode:"set_time",stepsNum:10,exerciseTime:1800,bpmStepDropdownOpen:!1,byTimeInterval:60,byBarInterval:2,constantBpmSlider:122,track:[[1,0,1,0,1,0],[1,1,1,1],[1,1,1,1,1,1],[0,0,0,0,0,0]],timeSignature:6,instrumentKey:"basicdrumkit",title:"2 over 3"},{isHeader:!0,title:"Other"},{title:"Balkan 1",bpmRange:[241,400],accents:[0,2,1,0,2,1,2],instrument:C.ELECTRO_KIT,playMode:"by_bar",interval:20,bpmStep:30},{title:"Balkan 2",bpmRange:[293,400],accents:[0,1,2,0,1,2,1],instrument:C.TABLA,playMode:"by_bar",interval:300,bpmStep:30},{title:"Groove 1",bpmRange:[222,262],accents:[0,1,2,1,2,0,2,2],instrument:C.ELECTRO_KIT,playMode:"by_time",interval:600,bpmStep:30},{title:"Groove 2",bpmRange:[222,400],accents:[0,1,0,1,1,1,0,2],instrument:C.ELECTRO_KIT,playMode:"by_bar",interval:20,bpmStep:30}],T=(C.ELECTRO_KIT.key,{bpmStep:50,bpmRange:[300,400],playbackMode:"stop",playMode:"constant",stepsNum:10,exerciseTime:600,bpmStepDropdownOpen:!1,byTimeInterval:5,byBarInterval:2,constantBpmSlider:300,track:[[1,1,0,0,0,0,0,1,0,0,1,1,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],timeSignature:16,samples:[{file:"Kick.wav",instrumentKey:"basicdrumkit"},{file:"Snare.wav",instrumentKey:"basicdrumkit"},{file:"ClosedHat.wav",instrumentKey:"basicdrumkit"},{file:"OpenHat.wav",instrumentKey:"basicdrumkit"}]});var I={"(shift) arrow up/down":"(shift) strza\u0142ki g\xf3ra/d\xf3\u0142","higher/lower BPM":"zwi\u0119ksz/zmniejsz BPM","arrow left/right":"strza\u0142ki lewa/prawa","previous/next step according to plan":"poprzedni/nast\u0119pny krok wg planu","start/stop":"zacznij/zatrzymaj",stop:"zatrzymaj",Control:"Kontrola","Start / Stop":"Zacznij / Zatrzymaj",Volume:"G\u0142o\u015bno\u015b\u0107",Instrument:"Instrument",Mode:"Tryb","Increase speed":"Zwi\u0119kszaj pr\u0119dko\u015b\u0107","BPM range":"Zakres BPM","By bar":"Co kilka takt\xf3w",bar:"takt","By time":"Co jaki\u015b czas","Set time":"W ustalonym czasie \u0107wicze\u0144",Constant:"Nie zwi\u0119kszaj","Increase speed every":"Zwi\u0119ksz pr\u0119dko\u015b\u0107 co","Number of steps":"Ilo\u015b\u0107 krok\xf3w","Up and Down":"Szybciej i wolniej",Shuffle:"Losowo","Exercise Time":"Czas \u0107wiczenia","Total time:":"Ca\u0142kowity czas:","Please select":"Prosz\u0119 wybra\u0107",Select:"Wybierz",Stop:"Zatrzymaj",Continue:"Kontynuuj",Repeat:"Od pocz\u0105tku","After plan":"Po zako\u0144czeniu","Step order":"Kolejno\u015b\u0107","Plan progress":"Post\u0119p planu","Step progress":"Post\u0119p kroku",Title:"Nazwa","Save current settings":"Zapisz bie\u017c\u0105ce ustawienia",Edit:"Edytuj","User presets":"Zapisane ustawienia",Presets:"Presety",Delete:"Usu\u0144","Save Preset":"Zapisz Ustawienia",Cancel:"Anuluj","Are you sure?":"Czy aby na pewno?","Are you sure to delete current preset?":"Czy jeste\u015b pewien, \u017ce chcesz usun\u0105\u0107 to ustawienie?",Save:"Zapisz",Polyrhythms:"Polirytmy",Basic:"Podstawowe","Drum Patterns":"Motywy perkusyjne","Afro-Cuban":"Afro-Kuba\u0144skie",Other:"Inne","Import Presets":"Wczytaj Presety","I can't read this file":"Nie potrafi\u0119 odczyta\u0107 tego pliku","Import from file":"Importuj z pliku","Export to file":"Eksportuj do pliku",Confirm:"Potwierd\u017a",Sequencer:"Sekwencer","Keyboard controls":"Skr\xf3ty klawiszowe",bars:{1:"takt",2:"takty",3:"takty",4:"takty",5:"takt\xf3w"},hours:{1:"godzina",2:"godziny",3:"godziny",4:"godziny",5:"godzin"},minutes:{1:"minuta",2:"minuty",3:"minuty",4:"minuty",5:"minut"},seconds:{1:"sekunda",2:"sekundy",3:"sekundy",4:"sekundy",5:"sekund"},hr:"godz.",hrs:"godz."};function P(){return navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage||navigator.language||navigator.browserLanguage||"en"}let x;switch(P()){case"pl":case"pl-PL":case"pl-pl":x=I;break;default:x={}}var R=function(e){return x[e]?x[e]:e};function N(e,t){if(x[t]){if(x[t][e])return x[t][e];{const e=x[t];return e[Object.keys(e)[Object.keys(e).length-1]]}}return t}var O=a(196),D=a(197);class _ extends s.Component{constructor(...e){super(...e),this.state={}}render(){return r.a.createElement(c.a,{className:"SimpleProgress"},r.a.createElement("div",{className:"bar",style:{width:this.props.value+"%",display:"block"}}))}}var A=_;const K={toLocaleDateTime:function(e){return e?new Date(e).toLocaleString(P(),{dateStyle:"long",timeStyle:"short"}):""},padTime:function(e){return e<10?"0"+e:e},formatTime:function(e){if(e)return K.formatTimeFull(e,"h","m","s",!0)},formatTimeLong:function(e){if(e)return K.formatTimeFull(e,"hours","minutes","seconds",!1)},formatTimeFull:function(e,t,a,s,r){let n=new Date(0,0,0,0,0,0,0);n.setSeconds(e);const i=n.getHours(),l=n.getMinutes(),o=n.getSeconds();let p="";return 0!==i&&(p+=i+" "+N(i,t)+" "),0!==l||0!==i?((0!==i&&0!==l||0!==l)&&(p+=(r?K.padTime(l):l)+" "+N(l,a)+" "),0!==o&&(p+=(r?K.padTime(o):o)+" "+N(o,s))):p+=n.getSeconds()+" "+N(o,s),p.trim()},storageAvailable:function(e){var t;try{t=window[e];var a="__storage_test__";return t.setItem(a,a),t.removeItem(a),!0}catch(s){return s instanceof DOMException&&(22===s.code||1014===s.code||"QuotaExceededError"===s.name||"NS_ERROR_DOM_QUOTA_REACHED"===s.name)&&t&&0!==t.length}}};var z=K;class L extends s.Component{constructor(...e){super(...e),this.state={playbackMode:this.props.playbackMode,playMode:this.props.playMode,steps:[],currentStepIdx:this.props.currentStepIdx,stepProgress:0,planProgress:0,isUpDown:!1,isPaused:!1},this.barRender=e=>{const t=this.state.currentStepIdx===e.stepIdx?"current-step":"";return r.a.createElement("div",{onClick:()=>this.startStep(e.stepIdx),className:"step clickable "+t,key:"key_"+e.stepIdx},e.duration!==1/0?r.a.createElement(r.a.Fragment,null,e.durationFormatted," (",e.durationBars," ",N(Math.floor(e.durationBars),"bars"),") "):"","@ ",e.bpm.toFixed(0)," bpm")}}makePlan(e){let t=[];const a=e.bpmRange[1];let s=e.bpmRange[0];if(e.playMode===b)for(;s<=a;){const a={bpm:s,duration:e.byBarInterval};t.push(a),s+=e.bpmStep}else if(e.playMode===y)for(;s<=a;){const a={duration:e.byTimeInterval,bpm:s};t.push(a),s+=e.bpmStep}else if(e.playMode===v){const a={duration:1/0,bpm:e.constantBpmSlider};t.push(a)}else if(e.playMode===k){const s=e.exerciseTime/e.stepsNum;let r=e.bpmRange[0];const n=(e.bpmRange[1]-e.bpmRange[0])/(e.stepsNum-1);for(;r<=a+1;){const e={duration:s,bpm:r};t.push(e),r+=n}}if(this.state.isUpDown){const e=t.slice().reverse();e.shift(),t=t.concat(e)}return this.state.isRandom&&(t=this.shuffle(t.slice())),t}shuffle(e){for(var t,a,s=e.length;0!==s;)a=Math.floor(Math.random()*s),t=e[s-=1],e[s]=e[a],e[a]=t;return e}onPlanStep(e){this.setState({currentStepIdx:e},this.stepChanged)}updateProgress(){const e=this.getStep(this.state.currentStepIdx),t=(this.props.transport.ticks-e.startTimeTicks)/p.a.Time(e.duration).toTicks(),a=this.props.transport.ticks/this.endTime;this.setState({stepProgress:this.clamp(t),planProgress:this.clamp(a)})}clamp(e,t=0,a=1){return Math.min(Math.max(e,t),a)}setPlan(e,t=0){const a=this.makePlan(e);this.baseBpm=this.props.transport.bpm.value;const s=e.timeSignature;let r=0;this.events=[];let n=[],i=0;for(let l=0;l<a.length;l++){const t=a[l],o=60/t.bpm;this.props.transport.schedule(e=>this.onPlanStep(l),r);const c=e.playMode===b?o*s*t.duration:t.duration,m=e.playMode===b?t.duration:t.duration/(o*s),h={bpm:t.bpm,duration:c,durationBars:m.toFixed(1),durationFormatted:z.formatTime(c),stepIdx:l,track:e.track,playMode:t.playMode,startTimeTicks:p.a.Time(r).toTicks()};switch(e.playMode){case y:case k:r+=this.calcTimeForBpm(t.duration,t.bpm);break;case b:r=t.duration*(l+1)+"m";break;case v:r=1/0;break;default:throw new Error("Invalid playMode: "+e.playMode)}i+=c,n.push(h)}this.props.transport.schedule(e=>this.onPlanEnd(e),r),this.endTime=p.a.Time(r).toTicks(),this.setState(t=>({totalPlanTime:i,currentStepIdx:0,steps:n,playMode:e.playMode}),this.stepChanged)}calcTimeForBpm(e,t){return p.a.Time(e*t/this.baseBpm)}startStep(e){if(this.state.currentStepIdx!==e){const t=this.getStep(e);this.props.transport.ticks=t.startTimeTicks,this.setState({currentStepIdx:e},this.stepChanged)}}getStep(e){return this.state.steps[e]}stepForward(){this.state.currentStepIdx+1<this.state.steps.length&&this.startStep(this.state.currentStepIdx+1)}stepBackward(){this.state.currentStepIdx-1>=0&&this.startStep(this.state.currentStepIdx-1)}onPlanEnd(e){this.state.playbackMode===S?this.props.onPlanEnd():this.state.playbackMode===f&&this.startStep(0)}stepChanged(){const e=this.getCurrentStep().bpm;this.props.onPlanStep(e)}getCurrentStep(){if(this.state.currentStepIdx>=this.state.steps.length)throw new Error("Trying to get step that doesn't exists");return this.state.steps[this.state.currentStepIdx]}onPlaybackChange(e){this.setState({playbackMode:e},this.props.onChange)}onUpDownBtn(){this.setState({isUpDown:!this.state.isUpDown,isRandom:!1},this.props.onChange)}onRandomBtn(){this.setState({isRandom:!this.state.isRandom,isUpDown:!1},this.props.onChange)}render(){return this.state.playMode===v?r.a.createElement("div",null):r.a.createElement(u,{title:"Plan"},r.a.createElement("div",{className:"Planner"},r.a.createElement("div",null,R("Step progress")," ",r.a.createElement(A,{value:100*this.state.stepProgress})),r.a.createElement("div",null,R("Plan progress")," ",r.a.createElement(A,{value:100*this.state.planProgress})),r.a.createElement("div",{style:{height:"200px",overflow:"auto"}},this.state.steps.map(e=>this.barRender(e))),r.a.createElement("div",null,R("Total time:")," ",z.formatTime(this.state.totalPlanTime))),r.a.createElement(O.a,{isOpen:this.state.playMode!==v},r.a.createElement("div",null,R("After plan")),r.a.createElement(D.a,{size:"sm"},r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onPlaybackChange(S),active:this.state.playbackMode===S},R("Stop")),r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onPlaybackChange(E),active:this.state.playbackMode===E},R("Continue")),r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onPlaybackChange(f),active:this.state.playbackMode===f},R("Repeat"))),r.a.createElement("div",null,R("Step order")),r.a.createElement(D.a,null,r.a.createElement(g.a,{size:"sm",outline:!0,onClick:e=>this.onUpDownBtn(e),active:this.state.isUpDown},R("Up and Down")),r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onRandomBtn(),active:this.state.isRandom},R("Shuffle")))))}}var F=L;L.defaultProps={playbackMode:T.playbackMode,playMode:T.playMode,onChange:()=>{},onPlanStep:()=>{},onPlanEnd:()=>{},currentStepIdx:NaN};var j=a(207),U=a(198),V=a(199),H=a(200),W=a(201);class X extends s.Component{constructor(...e){super(...e),this.state={modal:!1,nestedModal:!1,preset:null,presetId:null,showDelete:!1},this.toggle=()=>{this.setState(e=>({modal:!e.modal,nestedModal:!1}))},this.toggleNested=()=>{this.setState({nestedModal:!this.state.nestedModal})}}handleSave(){const e=this.state.preset,t=this.state.preset.title;t&&t.length>0&&(this.props.onSave(t,e),this.toggle())}edit(e,t,a){t&&a&&(e.presetId=t,e.title=a),this.setState({preset:e,showDelete:!!t},this.toggle)}titleChanged(e){const t=e.target.value;let a=Object(l.a)({},this.state.preset);a.title=t,this.setState({preset:a})}handleDelete(){this.props.onDeleteBtn(this.state.preset),this.toggle()}renderDelete(){if(!0===this.state.showDelete)return r.a.createElement(g.a,{color:"warning",onClick:this.toggleNested},R("Delete"))}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{style:{marginTop:"0.5em"},outline:!0,size:"sm",color:"light",onClick:this.props.onSaveBtn},R("Save current settings")),r.a.createElement(j.a,{isOpen:this.state.modal,toggle:this.toggle,className:this.props.className},r.a.createElement(U.a,{toggle:this.toggle},R("Save Preset")),r.a.createElement(V.a,null,r.a.createElement(H.a,{onChange:e=>this.titleChanged(e),placeholder:R("Title"),defaultValue:this.state.preset&&this.state.preset.title||""}),r.a.createElement(j.a,{isOpen:this.state.nestedModal,toggle:this.toggleNested},r.a.createElement(U.a,{toggle:this.toggleNested},R("Are you sure?")),r.a.createElement(V.a,null,R("Are you sure to delete current preset?")),r.a.createElement(W.a,null,r.a.createElement(g.a,{color:"warning",onClick:()=>this.handleDelete()},R("Delete")),r.a.createElement(g.a,{onClick:this.toggleNested},R("Cancel"))))),r.a.createElement(W.a,null,r.a.createElement(g.a,{color:"primary",onClick:()=>this.handleSave()},R("Save"))," ",r.a.createElement(g.a,{color:"secondary",onClick:this.toggle},R("Cancel")),this.renderDelete())))}}var J=X;X.defaultProps={onDeleteBtn:function(e){},onSave:function(e,t){},onSaveBtn:function(e,t){}};var G=a(202);class Z extends s.Component{constructor(...e){super(...e),this.state={modal:!1,showInvalidFileAlert:!1},this.toggle=()=>{this.setState(e=>({modal:!e.modal}))}}open(){this.toggle()}close(){this.setState({modal:!1,showInvalidFileAlert:!1})}onPresetsLoaded(e){try{let t=JSON.parse(e.target.result);this.setState({showInvalidFileAlert:!1}),this.props.onJsonReady(t)}catch(e){this.setState({showInvalidFileAlert:!0})}}onUploadBtn(e){var t=new FileReader;t.onload=e=>this.onPresetsLoaded(e),t.readAsText(e.target.files[0])}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{style:{marginTop:"0.5em"},outline:!0,size:"sm",color:"light",onClick:this.props.onImportBtn},R("Import from file")),r.a.createElement(j.a,{isOpen:this.state.modal,toggle:this.toggle,className:this.props.className},r.a.createElement(U.a,{toggle:this.toggle},R("Import Presets")),r.a.createElement(V.a,null,r.a.createElement(H.a,{type:"file",onChange:e=>this.onUploadBtn(e)}),r.a.createElement(G.a,{hidden:!this.state.showInvalidFileAlert,color:"danger"},R("I can't read this file"))),r.a.createElement(W.a,null,r.a.createElement(g.a,{color:"secondary",onClick:this.toggle},R("Cancel")))))}}var q=Z;Z.defaultProps={onJsonReady:function(){}};var Q={TRACKS_NUMBER:4,MAXIMUM_TIMESIGNATURE:24,MIN_BPM:10,MAX_BPM:1200,PROGRESS_UPDATE_FPS:30,COLOR_PALETTE:{0:"#FF715B",1:"#F9CB40",2:"#BCED09",3:"#2F52E0"}};class Y extends s.Component{constructor(e){super(e),this.state={showDelete:[],showEdit:[],userPresets:[]};const t=localStorage.getItem("userPresets");this.state.userPresets=t?JSON.parse(t):[],this.state.showDelete=this.state.userPresets?Array(this.state.userPresets.length).fill(!1):[],this.state.showEdit=this.state.userPresets?Array(this.state.userPresets.length).fill(!1):[]}validatePreset(e){if(e.byBarInterval=e.byBarInterval||e.interval||T.byBarInterval,e.byTimeInterval=e.byTimeInterval||e.interval||T.byTimeInterval,!e.track){let t=[];e.accents.map(e=>(t.push([e]),!0)),e.track=t}if(!e.timeSignature){const a=e.track.length;e.timeSignature=a;var t=new Array(Q.TRACKS_NUMBER).fill(0).map(e=>new Array(a).fill(0));for(let s=0;s<e.track.length;s++){const a=e.track[s];for(let e=0;e<a.length;e++)t[a[e]][s]=1}e.track=t}return e.samples||(e.samples=this.convertInstrumentKeyToSamples(e.instrumentKey)),e}convertInstrumentKeyToSamples(e){return w.filter(t=>t.instrumentKey===e)}onPresetClick(e){this.props.onSelect(this.validatePreset(e))}onSavePreset(e,t){const a=Object(l.a)({title:e},t);if(void 0===a.presetId){let e=1;this.state.userPresets.length>0&&(e=Math.max.apply(Math,this.state.userPresets.map((function(e){return e.presetId}))),e++),a.presetId=e}a.savedDtm=new Date;let s=this.state.userPresets,r=this.state.userPresets.findIndex(e=>e.presetId===a.presetId);r<0?s.push(a):s[r]=a,this.saveInLocalStorage(s)}saveInLocalStorage(e){localStorage.setItem("userPresets",JSON.stringify(e)),this.setState({userPresets:e})}showDeleteBtn(e,t){let a=Object(l.a)({},this.state);a[t]=!0,this.setState({showDelete:a})}showEditBtn(e,t,a){let s=Object(l.a)({},this.state);s[t]=!0,this.setState({showEdit:s})}hideEditBtn(e){this.setState({showEdit:!1})}onPresetDelete(e){let t=this.state.userPresets.findIndex(t=>t.presetId===e.presetId),a=this.state.userPresets.slice();if(t<0)throw new Error("Selected preset "+e.title+" has not been found in the store");a.splice(t,1),this.saveInLocalStorage(a)}onPresetEdit(e,t){var a=this.props.getPreset();void 0!==t?this.refs.presetEditor.edit(a,this.state.userPresets[t].presetId,this.state.userPresets[t].title):this.refs.presetEditor.edit(a)}onImportBtn(e){this.refs.importDialog.open()}renderUserPresets(e){if(0!==e.length)return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,null,R("User presets"),":"),e.map((e,t)=>r.a.createElement(m.a,{className:"presetItem clickable",onClick:()=>this.onPresetClick(e),key:"preset_"+t},r.a.createElement(h.a,{style:{textAlign:"left"}},e.title),r.a.createElement(h.a,{xs:"auto",className:"userPresetSavedDtm"},z.toLocaleDateTime(e.savedDtm)),r.a.createElement(h.a,null,r.a.createElement(g.a,{size:"sm",outline:!0,onClick:e=>this.onPresetEdit(e,t)},R("Edit"))))))}onExport(){const e=document.createElement("a"),t=new Blob([JSON.stringify(this.state.userPresets)],{type:"application/json"});e.href=URL.createObjectURL(t),e.download="presets.json",e.click()}onPresetsImport(e){e.forEach(e=>{(e=this.validatePreset(e)).presetId=void 0,this.onSavePreset(e.title,e)}),this.refs.importDialog.close()}render(){const e=localStorage.getItem("userPresets");let t=e?JSON.parse(e):[];return r.a.createElement(u,{className:"PresetsManager",title:R("Presets")},r.a.createElement(c.a,null,B.map((e,t)=>e.isHeader?r.a.createElement(m.a,{className:"presetHeader",key:"header_"+t},R(e.title),":"):r.a.createElement(m.a,{onClick:()=>this.onPresetClick(e),className:"presetItem clickable",key:"preset_"+t},e.title)),this.renderUserPresets(t),r.a.createElement(m.a,{style:{justifyContent:"center"}},r.a.createElement(J,{ref:"presetEditor",onDeleteBtn:e=>this.onPresetDelete(e),onSaveBtn:(e,t)=>this.onPresetEdit(e,t),onSave:(e,t)=>this.onSavePreset(e,t)}),r.a.createElement(q,{ref:"importDialog",onImportBtn:()=>this.onImportBtn(),onJsonReady:e=>this.onPresetsImport(e)}),r.a.createElement(g.a,{style:{marginTop:"0.5em"},outline:!0,size:"sm",color:"light",onClick:()=>this.onExport()},R("Export to file")))))}}var $=Y;Y.defaultProps={onSelect:function(e){}};var ee=a(55);class te extends s.Component{constructor(...e){super(...e),this.state={track:this.props.track,timeSignature:this.props.timeSignature},this.colorEmpty="#333",this.strokeColor="#444",this.strokeWidth="0.001em"}setAccents(e){this.setState({track:e})}getCoordinatesForPercent(e,t=1){return[t*Math.cos(2*Math.PI*e),t*Math.sin(2*Math.PI*e)]}drawSlices(e,t){let a=1/this.props.track[t].length,s=[];this.props.track[t].forEach((e,r)=>{s.push({percent:a,color:e>0?Q.COLOR_PALETTE[t]:this.colorEmpty})});let n=0,i=[];return s.forEach((t,a)=>{const s=this.getCoordinatesForPercent(n,e),l=Object(ee.a)(s,2),o=l[0],p=l[1];n+=t.percent;const c=this.getCoordinatesForPercent(n,e),m=Object(ee.a)(c,2),h=m[0],d=m[1],u=t.percent>.5?1:0,g=["M ".concat(o," ").concat(p),"A ".concat(e," ").concat(e," 0 ").concat(u," 1 ").concat(h," ").concat(d),"L 0 0"].join(" ");i.push(r.a.createElement("path",{key:"pie_"+a,d:g,fill:t.color,stroke:this.strokeColor,strokeWidth:this.strokeWidth}))}),i}drawText(){let e=[];const t=1/this.props.timeSignature;let a=0;for(let s=0;s<this.props.timeSignature;s++){let n=this.getCoordinatesForPercent(a,.9),i=Object(ee.a)(n,2),l=i[0],o=i[1];l-=.06,e.push(r.a.createElement("text",{x:l,y:o,key:"label_"+s,textAnchor:"middle",transform:"rotate(90, "+l+", "+o+")",className:"svgText"},s+1)),a+=t}return r.a.createElement("g",null,e)}setProgress(e){this.line.style.transform="rotate("+360*e+"deg)"}render(){let e=.5/Q.TRACKS_NUMBER,t=[];for(let a=0;a<this.props.track.length;a++)t.push(this.drawSlices(.8-e*a,a));return t.push(r.a.createElement("circle",{key:"innerCircle",cx:"0",cy:"0",r:.8-e*Q.TRACKS_NUMBER,fill:this.colorEmpty,stroke:this.strokeColor,strokeWidth:this.strokeWidth})),r.a.createElement("div",{ref:e=>this.container=e,className:"visClockContainer"},r.a.createElement("svg",{viewBox:"-1 -1 2 2",ref:e=>this.svg=e},r.a.createElement("g",{style:{transform:"rotate(-90deg)"}},t,this.drawText(),r.a.createElement("line",{ref:e=>this.line=e,strokeLinecap:"round",x1:"0",y1:"0",x2:".7",y2:"0",stroke:"rgba(255,255,255,0.5)",strokeWidth:"0.1",style:{transform:"rotate("+360*this.props.partProgress+"deg)"}}))))}}var ae=te;te.defaultProps={track:T.track,timeSignature:T.timeSignature};var se=a(209),re=a(210),ne=a(211),ie=a(206),le=a(26),oe=a(105),pe=a.n(oe),ce=a(204);class me extends s.Component{constructor(e){super(e),this.state={value:this.props.defaultValue,regression:void 0},this.onMinusClick=()=>{const e=this.state.value-this.state.btnStep;this.setState({value:e},this.props.onChange(e))},this.onPlusClick=()=>{const e=this.state.value+this.state.btnStep;this.setState({value:e},this.props.onChange(e))};const t=[[0,this.props.min],[100,this.props.max]];this.state.regression=pe.a.exponential(t,{precision:10}),this.prepareMarks(),this.state.value=this.props.defaultValue,this.state.btnStep=e.btnStep||1}prepareMarks(){this.marks={};for(let e=0;e<this.props.marksAt.length;e++)this.marks[this.findX(this.props.marksAt[e])]=this.props.marksAt[e]}onChange(e){const t=Math.floor(this.state.regression.predict(e)[1]);this.setState({value:t}),this.props.onChange(t)}findX(e){return Math.log(e)/this.state.regression.equation[1]}setValue(e){this.setState({value:e})}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(g.a,{size:"sm",outline:!0,className:"inlineBtn",onClick:this.onMinusClick},"-"),r.a.createElement(ce.a,{color:"light",onClick:this.onBadgeClick,className:"d-i"},this.props.badgeFormatter(this.state.value)),r.a.createElement(g.a,{size:"sm",outline:!0,className:"inlineBtn",onClick:this.onPlusClick},"+")),r.a.createElement(le.b,{ref:"slider",included:!1,value:this.findX(this.state.value),style:{height:"45px"},onChange:e=>this.onChange(e),min:0,max:100,step:.5,marks:this.marks}))}}var he=me;me.defaultProps={marksNum:6,marksStyle:{color:"#ccc"},desc:"",badgeFormatter:function(e){return e},markFormatter:function(e){return e},marksAt:[]};var de=a(205),ue=a(208);class ge extends s.Component{constructor(...e){super(...e),this.state={modal:!1,value:this.props.value,showInvalidRange:!1}}open(){this.setState({modal:!0,value:this.props.value,showInvalidRange:!1})}close(){this.setState({modal:!1})}onOk(){this.state.value.min>=this.state.value.max?this.setState({showInvalidRange:!0}):(this.props.onChange(this.state.value),this.close())}onMinValueChange(e){let t=Number(e.target.value),a=this.state.value;a.min=t,this.setState({value:a})}onMaxValueChange(e){let t=Number(e.target.value),a=this.state.value;a.max=t,this.setState({value:a})}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{isOpen:this.state.modal,className:this.props.className},r.a.createElement(V.a,null,r.a.createElement(de.a,null,r.a.createElement(ue.a,{addonType:"prepend"},R("From")),r.a.createElement(H.a,{min:this.props.min,max:this.props.max,type:"number",value:this.state.value.min,onChange:e=>this.onMinValueChange(e),step:"1"})),r.a.createElement(de.a,null,r.a.createElement(ue.a,{addonType:"prepend"},R("To")),r.a.createElement(H.a,{min:this.props.min,max:this.props.max,type:"number",value:this.state.value.max,onChange:e=>this.onMaxValueChange(e),step:"1"})),r.a.createElement(G.a,{hidden:!this.state.showInvalidRange,color:"danger"},R("Invalid range!"))),r.a.createElement(W.a,null,r.a.createElement(g.a,{color:"secondary",onClick:()=>this.onOk()},R("OK")),r.a.createElement(g.a,{color:"secondary",onClick:()=>this.close()},R("Cancel")))))}}var be=ge;ge.defaultProps={onChange:function(){},title:""};class ye extends le.a{onBadgeClick(){this.refs.editor.open()}onEdit(e){this.setState({bounds:[e.min,e.max]},()=>this.props.onAfterChange(this.state.bounds))}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(ce.a,{color:"light",onClick:this.props.editInPlace?()=>this.onBadgeClick():function(){},className:this.props.editInPlace?"clickable":""},this.state.bounds[0]," - ",this.state.bounds[1]),r.a.createElement(be,{ref:"editor",title:this.props.title,value:{min:this.state.bounds[0],max:this.state.bounds[1]},min:this.props.min,max:this.props.max,onChange:e=>this.onEdit(e)})),r.a.createElement("div",{style:{height:"30px"}},super.render()))}}var ke=ye;ye.defaultProps=Object.assign({},le.a.defaultProps,{editInPlace:!1,title:""});class ve extends s.Component{constructor(...e){super(...e),this.state={modal:!1,value:this.props.value}}open(){this.setState({modal:!0,value:this.props.value})}close(){this.setState({modal:!1})}onOk(){this.props.onChange(this.state.value),this.close()}onValueChange(e,t){let a=Number(e.target.value);this.setState({value:a})}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{isOpen:this.state.modal,className:this.props.className},r.a.createElement(V.a,null,r.a.createElement(de.a,null,r.a.createElement(ue.a,{addonType:"prepend"},this.props.title),r.a.createElement(H.a,{min:this.props.min,max:this.props.max,type:"number",value:this.state.value,onChange:e=>this.onValueChange(e),step:"1"}))),r.a.createElement(W.a,null,r.a.createElement(g.a,{color:"secondary",onClick:()=>this.onOk()},R("OK")),r.a.createElement(g.a,{color:"secondary",onClick:()=>this.close()},R("Cancel")))))}}var Se=ve;ve.defaultProps={onChange:function(){},title:""};class fe extends le.b{constructor(e){super(e),this.onMinusClick=()=>{const e=this.state.value-this.state.btnStep;this.setState({value:e},this.props.onChange(e))},this.onPlusClick=()=>{const e=this.state.value+this.state.btnStep;this.setState({value:e},this.props.onChange(e))},this.state.btnStep=e.btnStep||1}onEdit(e){e>=this.props.min&&e<=this.props.max&&this.setState({value:e},this.props.onChange(e))}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"advancedSlider"},!0===this.props.disableBtns?"":r.a.createElement(g.a,{size:"sm",outline:!0,className:"inlineBtn",onClick:this.onMinusClick},"-"),r.a.createElement(ce.a,{onClick:this.props.editInPlace?e=>this.onBadgeClick(e):function(){},color:"light",className:this.props.editInPlace?"clickable":""},this.state.value),this.props.editInPlace?r.a.createElement(Se,{ref:"editor",title:this.props.title,value:this.state.value,min:this.props.min,max:this.props.max,onChange:e=>this.onEdit(e)}):"",!0===this.props.disableBtns?"":r.a.createElement(g.a,{size:"sm",outline:!0,className:"inlineBtn",onClick:this.onPlusClick},"+")),r.a.createElement("div",{style:{height:"30px"}},r.a.createElement("div",null,super.render())))}onBadgeClick(e){this.refs.editor&&this.refs.editor.open()}}var Ee=fe;fe.defaultProps=Object.assign({},le.b.defaultProps,{editInPlace:!1,title:""});class Ce extends s.Component{constructor(e){super(e),this.state={value:void 0,innerValue:0},this.state.innerMarks={},Object.values(this.props.marks).map((e,t)=>(this.state.innerMarks[t]={label:e.label},!0))}componentDidUpdate(e,t){var a=this.props.value,s=void 0!==a?a:t.value,r=Object.keys(this.props.marks).indexOf(s+"");r!==t.innerValue&&this.setState({innerValue:r,value:a})}onSliderChange(e){const t=Object.values(this.props.marks)[e].value;this.setState({innerValue:e,value:t}),this.props.onChange(t)}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(ce.a,{color:"light",className:"d-i"},this.props.badgeFormatter(this.state.value))),r.a.createElement("div",{style:{height:"3.5em",width:"95%",margin:"auto",whiteSpace:"nowrap"}},r.a.createElement(le.b,{ref:"slider",included:!1,value:this.state.innerValue,style:{height:"3.5em"},onChange:e=>this.onSliderChange(e),min:0,max:Object.keys(this.props.marks).length-1,step:1,marks:this.state.innerMarks})))}}var we=Ce;Ce.defaultProps={badgeFormatter:function(e){return e},markFormatter:function(e){return e},defaultValue:0};class Me extends s.Component{constructor(...e){super(...e),this.state={bpmStep:this.props.bpmStep,bpmRange:this.props.bpmRange,playbackMode:this.props.playbackMode,playMode:this.props.playMode,stepsNum:this.props.stepsNum,exerciseTime:this.props.exerciseTime,bpmStepDropdownOpen:!1,byTimeInterval:this.props.byTimeInterval,byBarInterval:this.props.byBarInterval,constantBpmSlider:this.props.constantBpmSlider},this.onBpmSliderChange=e=>{this.setState({constantBpmSlider:e},this.onAfterChange)}}onAfterChange(e){this.props.onChange()}onModeChange(e){let t=Object(l.a)({},this.state);e===v&&e!==this.state.playMode&&(t.constantBpmSlider=this.props.transport.bpm.value),t.playMode=e,this.setState(t,this.onAfterChange)}onBpmRangeChange(e){this.setState({bpmRange:e},this.onAfterChange)}onBpmStepChange(){this.setState(e=>({bpmStepDropdownOpen:!e.bpmStepDropdownOpen}))}onBpmStepSelect(e){this.setState({bpmStep:e},this.onAfterChange)}setValue(e){this.refs.byBarSlider.setValue(e.byBarInterval||T.byBarInterval),this.refs.byTimeSlider.setValue(e.byTimeInterval||T.byTimeInterval),this.refs.bpmRange.setState({bounds:e.bpmRange}),this.setState({playMode:e.playMode,playbackMode:e.playbackMode||this.state.playbackMode,bpmStep:e.bpmStep,exerciseTime:e.exerciseTime||this.state.exerciseTime,stepsNum:e.stepsNum||this.state.stepsNum,byBarInterval:e.byBarInterval,byTimeInterval:e.byTimeInterval,bpmRange:e.bpmRange,constantBpmSlider:e.constantBpmSlider||this.state.constantBpmSlider},this.onAfterChange)}onTimeIntervalChange(e){this.setState({byTimeInterval:e,interval:e},this.onAfterChange)}onBarIntervalChange(e){this.setState({byBarInterval:e,interval:e},this.onAfterChange)}byBarFormatter(e){return e+" "+N(e,"bars")}renderIncreaseBpmDropdown(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(se.a,{style:{margin:"0px 5px"},isOpen:this.state.bpmStepDropdownOpen,toggle:()=>this.onBpmStepChange()},r.a.createElement(re.a,{caret:!0,size:"sm",outline:!0,color:"light"},this.state.bpmStep),r.a.createElement(ne.a,null,[1,2,3,5,10,15,20,30,50,100].map(e=>r.a.createElement(ie.a,{key:"bpm_"+e,onClick:()=>{this.onBpmStepSelect(e)}},e)))),"bpm")}onStepsSliderChange(e){this.setState({stepsNum:e},this.onAfterChange)}onExerciseTimeSliderChange(e){this.setState({exerciseTime:e},this.onAfterChange)}renderTimeSlider(){const e={};return[300,600,900,1200,1800,3600,7200,10800].map(t=>(e[t]={value:t,label:z.formatTime(t)},!0)),r.a.createElement("div",null,R("Exercise Time"),r.a.createElement(we,{ref:"exerciseTimeSlider",badgeFormatter:z.formatTimeLong,markFormatter:z.formatTime,marks:e,value:this.state.exerciseTime,onChange:e=>this.onExerciseTimeSliderChange(e)}))}renderStepsSlider(){return r.a.createElement("div",null,R("Number of steps"),r.a.createElement(Ee,{ref:"stepsSlider",min:2,included:!1,max:100,marks:{1:"1",5:"5",10:"10",15:"15",20:"20",30:"30",40:"40",50:"50",60:"60",70:"70",80:"80",90:"90",100:"100"},value:this.state.stepsNum,onChange:e=>this.onStepsSliderChange(e)}))}renderSpeedRange(){return r.a.createElement("div",null,R("BPM range"),r.a.createElement(ke,{ref:"bpmRange",min:Q.MIN_BPM,max:Q.MAX_BPM,defaultValue:[this.state.bpmRange[0],this.state.bpmRange[1]],editInPlace:!0,pushable:!0,onAfterChange:e=>this.onBpmRangeChange(e)}))}render(){return r.a.createElement(u,{className:"ModePanel",title:"Mode",width:"300px"},r.a.createElement("h6",null,R("Increase speed")),r.a.createElement(D.a,{size:"sm"},r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onModeChange(k),active:this.state.playMode===k},R("Set time")),r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onModeChange(b),active:this.state.playMode===b},R("By bar")),r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onModeChange(y),active:this.state.playMode===y},R("By time")),r.a.createElement(g.a,{size:"sm",outline:!0,onClick:()=>this.onModeChange(v),active:this.state.playMode===v},R("Constant"))),r.a.createElement(O.a,{isOpen:this.state.playMode!==v},this.renderSpeedRange()),r.a.createElement(O.a,{isOpen:this.state.playMode===k},this.renderTimeSlider(),this.renderStepsSlider()),r.a.createElement(O.a,{isOpen:this.state.playMode===b},r.a.createElement("div",null,R("Increase speed every"),r.a.createElement(he,{ref:"byBarSlider",defaultValue:this.state.byBarInterval,badgeFormatter:this.byBarFormatter,onChange:e=>this.onBarIntervalChange(e),min:1,max:301,marksAt:[1,2,5,10,20,50,100,300]}))),r.a.createElement(O.a,{isOpen:this.state.playMode===y},r.a.createElement("div",null,R("Increase speed every"),r.a.createElement(he,{ref:"byTimeSlider",defaultValue:this.state.byTimeInterval,badgeFormatter:z.formatTimeLong,markFormatter:z.formatTime,onChange:e=>this.onTimeIntervalChange(e),min:1,max:1200,marksAt:[1,2,5,10,30,60,120,240,600,1200]}))),r.a.createElement(O.a,{isOpen:this.state.playMode!==v&&this.state.playMode!==k},this.renderIncreaseBpmDropdown()),r.a.createElement(O.a,{isOpen:this.state.playMode===v},r.a.createElement("div",null,R("BPM"),r.a.createElement(Ee,{ref:"constantBpmSlider",title:R("BPM"),included:!1,editInPlace:!0,min:Q.MIN_BPM,btnStep:10,max:Q.MAX_BPM,marks:{30:"30",200:"200",400:"400",600:"600",800:"800",1e3:"1000",1200:"1200"},value:this.state.constantBpmSlider,onChange:this.onBpmSliderChange}))))}}var Be=Me;Me.defaultProps={playMode:T.playMode,playbackMode:T.playbackMode,interval:T.interval,bpmStep:T.bpmStep,bpmRange:T.bpmRange,byTimeInterval:T.byTimeInterval,byBarInterval:T.byBarInterval,stepsNum:T.stepsNum,exerciseTime:T.exerciseTime,constantBpmSlider:T.constantBpmSlider,onAfterChange:null};class Te extends s.Component{constructor(...e){super(...e),this.state={activeIdx:null,label:R("Please select")}}componentDidMount(){if(!T.samples[this.props.idx])return;const e=M[T.samples[this.props.idx].instrumentKey],t=T.samples[this.props.idx].file;this.onSampleSelect(e.key,t)}addBeat(){this.props.trackRow.length<Q.MAXIMUM_TIMESIGNATURE&&this.props.onMeasureChange(this.props.trackRow.length+1)}removeBeat(){this.props.trackRow.length>1&&this.props.onMeasureChange(this.props.trackRow.length-1)}onSampleChange(){this.setState(e=>({sampleDropdownOpen:!e.sampleDropdownOpen}))}onSampleSelect(e,t){this.props.soundLibrary.use(this.props.idx,e,t)}render(){return r.a.createElement("div",{className:"trackRow"},r.a.createElement("div",{className:"label"},r.a.createElement(se.a,{isOpen:this.state.sampleDropdownOpen,toggle:()=>this.onSampleChange()},r.a.createElement(re.a,{caret:!0,size:"sm",outline:!0,style:{width:"6rem"},color:"light",ref:"dropdown"},this.props.soundLibrary.playersArr[this.props.idx]?this.props.soundLibrary.playersArr[this.props.idx].fullLabel:R("Select")),r.a.createElement(ne.a,null,w.map((e,t)=>r.a.createElement(ie.a,{key:"row_"+t,onClick:()=>this.onSampleSelect(e.instrumentKey,e.file)},M[e.instrumentKey].label," - ",e.label)))),r.a.createElement(ce.a,{color:"outline",style:{alignSelf:"center",width:"1.2rem"}},this.props.trackRow.length),r.a.createElement(D.a,{size:"xs",vertical:!0},r.a.createElement(g.a,{onClick:()=>this.addBeat()},"+"),r.a.createElement(g.a,{onClick:()=>this.removeBeat()},"-"))),r.a.createElement("div",{className:"cells",ref:"cellsDiv"},this.props.trackRow.map((e,t)=>{const a={};return this.props.trackRow[t]&&(a.backgroundColor=Q.COLOR_PALETTE[this.props.idx]),r.a.createElement("div",{key:"cell_"+t,className:"clickable cell",style:a,onClick:()=>this.props.onClick(this.props.idx,t)})})))}}var Ie=Te;Te.defaultProps={};class Pe extends s.Component{constructor(...e){super(...e),this.state={timeSignature:this.props.timeSignature},this.rowRefs=[]}handleCellClick(e,t){let a=[...this.props.track],s=a[e][t];a[e][t]=s>0?0:1,this.props.onChange(a,this.props.timeSignature)}setProgress(e){this.indicator.style.left=this.indicator.minLeft+e*(this.indicator.maxRight-this.indicator.minLeft)+"px"}updateDimensions(){const e=this.refs.trackRow_0.refs.cellsDiv.getBoundingClientRect(),t=this.refs.trackRow_3.refs.cellsDiv.getBoundingClientRect(),a=(e.left,e.top),s=t.bottom,r=(t.right,this.refs.indicator),n=this.refs.trackRow_0.refs.cellsDiv.offsetLeft;r.minLeft=this.refs.trackRow_0.refs.cellsDiv.offsetLeft;const i=n+this.refs.trackRow_0.refs.cellsDiv.offsetWidth;r.style.left=n+"px",r.maxRight=i,r.style.height=s-a+"px",this.indicator=r}componentDidMount(){window.addEventListener("resize",()=>this.updateDimensions()),this.updateDimensions()}addBeat(){if(this.props.timeSignature<Q.MAXIMUM_TIMESIGNATURE){let e=[...this.props.track];for(let t=0;t<e.length;t++)e[t].length<Q.MAXIMUM_TIMESIGNATURE&&e[t].push(0);this.props.onChange(e,this.props.timeSignature+1)}}removeBeat(){if(this.props.timeSignature>1){let e=[...this.props.track];for(let t=0;t<e.length;t++)e[t].length>1&&e[t].pop();this.props.onChange(e,this.props.timeSignature-1)}}onTrackRowSignatureChange(e,t){if(t<24){let a=[...this.props.track];t>a[e].length?a[e].push(0):a[e].pop(),this.props.onChange(a,this.props.timeSignature)}}componentDidUpdate(){this.updateDimensions()}render(){let e=0;return this.indicator&&(e=this.indicator.minLeft+this.props.partProgress*(this.indicator.maxRight-this.indicator.minLeft)+"px"),r.a.createElement(u,{style:{padding:"15px"},title:R("Sequencer")},r.a.createElement("div",{className:"trackView"},r.a.createElement("div",{className:"trackContainer"},r.a.createElement("div",{className:"indicator",ref:"indicator",style:{left:e}}),[0,1,2,3].map(e=>r.a.createElement(Ie,{idx:e,ref:"trackRow_"+e,soundLibrary:this.props.soundLibrary,onMeasureChange:t=>this.onTrackRowSignatureChange(e,t),key:"trackRow_"+e,timeSignature:this.props.timeSignature,progress:this.props.progress,trackRow:this.props.track[e],onClick:(e,t)=>this.handleCellClick(e,t)}))),r.a.createElement("div",{className:"btnContainer"},r.a.createElement(D.a,{size:"sm",vertical:!0},r.a.createElement(g.a,{onClick:()=>this.addBeat()},"+"),r.a.createElement(g.a,{onClick:()=>this.removeBeat()},"-")),r.a.createElement("div",{height:"1em"},r.a.createElement(ce.a,{className:"beatsCntBadge",color:"dark"},this.props.timeSignature)))))}}var xe=Pe;Pe.defaultProps={track:T.track};var Re=a(108),Ne=a.n(Re);var Oe=class{constructor(e){this.players=new p.a.Players({}),this.playersArr=[],this.reverb=(new p.a.Reverb).toMaster(),this.reverb.decay=4,this.reverb.predelay=.05,this.reverb.generate(),this.reverb.wet.value=0,this.players.connect(this.reverb),this.players.toMaster()}use(e,t,a){const s=M[t];this.players.add("player_"+e,"./audio/"+t+"/"+a);let r=this.players.get("player_"+e);r.instrument=s,r.file=a,r.idx=e,r.fullLabel=w.find(e=>e.file===a).label,this.playersArr[e]=r}getSamples(){let e=[];return this.playersArr.map(t=>(e.push({file:t.file,instrumentKey:t.instrument.key}),!0)),e}play(e,t){const a=this.playersArr[e];a&&a.loaded&&a.start(t)}setReverb(e){this.reverb.wet.value=e}};class De extends s.Component{constructor(...e){super(...e),this.soundLibrary=new Oe,this.state={initialized:!1,config:T,track:this.props.track,timeSignature:this.props.timeSignature},this.transport=p.a.Transport,this.tone=p.a,this.repeat=(e,t)=>{this.soundLibrary.play(t,e)},this.setBpm=e=>{if(isNaN(e)||e<=0||e>1200)throw new Error("Invalid BPM value: "+e);e!==this.transport.bpm.value&&(p.a.Transport.bpm.value=e,document.title=e.toFixed(0)+" | "+this.documentTitle,this.setState({bpm:e}))}}componentDidMount(){p.a.Transport.lookAhead=10,this.part=new p.a.Part((e,t)=>this.repeat(e,t),[]),this.part.loop=!0,this.part.start(0);const e=this.getConfig();this.setPlan(e),this.initProgressUpdate(),this.documentTitle=document.title,this.setState({initialized:!0}),this.props.onReady()}getConfig(){return Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({},this.refs.modePanel.state),{track:this.state.track}),{timeSignature:this.state.timeSignature}),{samples:this.soundLibrary.getSamples()})}initProgressUpdate(){setInterval(()=>this.onProgress(),1e3/Q.PROGRESS_UPDATE_FPS)}setPlan(e){this.transport.cancel(),this.transport.position=0,this.setTrack(e.track.slice(),e.timeSignature),this.refs.planner.setPlan(e)}createPoly(e,t,a){const s=this.tone.Time("1m").toTicks()/e.length;for(let r=0;r<e.length;r++)e[r]>0&&this.part.add(s.toFixed(0)*r+"i",t)}setTrack(e,t){if(this.state.track!==e){e.length<Q.TRACKS_NUMBER&&e.push(new Array(t).fill(0)),this.setTimeSignature(t),this.part.removeAll();for(let a=0;a<e.length;a++)this.createPoly(e[a],a,t);this.part.loopEnd="1m",this.part.start(0),this.setState({track:e,timeSignature:t})}}onProgress(){"stopped"!==this.transport.state&&(this.refs.debug&&(this.refs.debug.innerHTML=this.transport.seconds.toFixed(1)),this.refs.planner&&this.refs.planner.updateProgress(),this.refs.svgClock.setProgress(this.part.progress),this.refs.trackView.setProgress(this.part.progress))}calcTimeForBpm(e,t){return p.a.Time(e*t/this.baseBpm)}setTimeSignature(e){e!==this.transport.timeSignature&&(this.transport.timeSignature=e)}toggle(){"started"===p.a.Transport.state?this.stop():this.start()}onPlanStep(e){this.setBpm(e)}onControlChange(){const e=this.getConfig();this.setPlan(e)}onPresetSelect(e){this.setState({track:e.track,timeSignature:e.timeSignature},(function(){this.refs.modePanel.setValue(e)}));for(let t=0;t<e.samples.length;t++)this.soundLibrary.use(t,e.samples[t].instrumentKey,e.samples[t].file)}onTrackChange(e,t){if(this.state.timeSignature!==t){const a=this.getConfig();a.track=e,a.timeSignature=t,this.setPlan(a)}else this.setTrack(e,t)}onVolumeChange(e){this.tone.Master.volume.value=60*e/100-60+6}onReverbChange(e){this.soundLibrary.setReverb(e/100)}handleKey(e,t){switch(t.preventDefault(),e){case"s":case"space":this.toggle();break;case"esc":this.stop();break;case"left":this.refs.planner.stepBackward();break;case"right":this.refs.planner.stepForward();break;case"up":this.state.bpm<1200&&this.setBpm(this.state.bpm+1);break;case"down":this.state.bpm>10&&this.setBpm(this.state.bpm-1);break;case"shift+up":this.state.bpm<1200&&this.setBpm(this.state.bpm+10);break;case"shift+down":this.state.bpm>10&&this.setBpm(this.state.bpm-10)}}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ne.a,{handleKeys:["s","space","esc","left","right","up","down","shift+up","shift+down"],onKeyEvent:(e,t)=>this.handleKey(e,t)}),r.a.createElement(c.a,null,r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement(u,{title:R("Control")},r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement(g.a,{onClick:()=>this.toggle(),color:this.state.isPlaying?"secondary":"light",block:!0},R("Start / Stop")))),r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement("h2",null,r.a.createElement("span",{ref:"bpmInfo",className:"badge badge-dark bpm-info"},"BPM: ",p.a.Transport.bpm.value.toFixed(0))))),r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement("div",null,R("Volume")),r.a.createElement("div",null,r.a.createElement(Ee,{ref:"volumeSlider",min:0,disableBtns:!0,btnStep:1,max:100,defaultValue:90,onChange:e=>this.onVolumeChange(e)})),r.a.createElement("div",null,R("Reverb")),r.a.createElement("div",null,r.a.createElement(Ee,{ref:"reverbSlider",min:0,disableBtns:!0,btnStep:1,max:100,defaultValue:0,onChange:e=>this.onReverbChange(e)})))))),r.a.createElement(h.a,{style:{margin:"auto"}},r.a.createElement(ae,{ref:"svgClock",soundLibrary:this.soundLibrary,timeSignature:this.state.timeSignature,track:this.state.track}))),r.a.createElement(m.a,null,r.a.createElement(Be,{ref:"modePanel",transport:this.transport,onChange:()=>this.onControlChange()})),r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement(xe,{ref:"trackView",soundLibrary:this.soundLibrary,track:this.state.track,instrument:this.state.instrument,timeSignature:this.state.timeSignature,onChange:(e,t)=>this.onTrackChange(e,t)}))),r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement(F,{transport:this.transport,onChange:()=>this.onControlChange(),onPlanStep:e=>this.onPlanStep(e),onPlanEnd:()=>this.stop(),ref:"planner"}))),r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement($,{ref:"presetsManager",getPreset:()=>this.getConfig(),onSelect:e=>this.onPresetSelect(e)})))))}stop(){this.transport.stop(),this.transport.position=0,this.setState({isPlaying:!1})}start(){this.transport.start("+.1"),this.part.start(),this.setState({isPlaying:!0})}}var _e=De;De.defaultProps={instrument:T.instrument,track:T.track,timeSignature:T.timeSignature,onReady:function(){}};a(191),a(192);var Ae=a(74);class Ke extends s.Component{constructor(...e){super(...e),this.state={showMask:!0}}componentDidMount(){Ae.a.initialize({trackingId:"UA-151010848-1",debug:!1,gaOptions:{cookieDomain:"none"}}),Ae.a.pageview(window.location.pathname+window.location.search)}removeLoadMask(){this.setState({showMask:!1})}render(){return r.a.createElement("div",{className:"App"},r.a.createElement(c.a,{className:"app-container "},r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement(_e,{ref:"sm",onReady:()=>this.removeLoadMask()}))),r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement(u,{title:R("Keyboard controls"),className:"about"},r.a.createElement("div",null,r.a.createElement("code",null,R("(shift) arrow up/down"))," - ",R("higher/lower BPM")),r.a.createElement("div",null,r.a.createElement("code",null,R("arrow left/right"))," - ",R("previous/next step according to plan")),r.a.createElement("div",null,r.a.createElement("code",null,"space, s")," - ",R("start/stop")),r.a.createElement("div",null,r.a.createElement("code",null,"esc")," - ",R("stop"))))),r.a.createElement(m.a,null,r.a.createElement(h.a,null,r.a.createElement("div",{className:"footer"},r.a.createElement("div",null,r.a.createElement("h6",null,"If you like this app consider donation to a developer using following ",r.a.createElement(ce.a,{href:"https://www.buymeacoffee.com/indiebubbler",target:"blank"},"link"))),r.a.createElement("div",null,"Join discord using ",r.a.createElement(ce.a,{href:"https://discord.gg/fAwnmVh",target:"blank"},"this link")," for feedback and improvement suggestions."),r.a.createElement("div",null,"By using this site you agree to the use of cookies to store user defined presets and analytics."),r.a.createElement("div",null,"If you want help translating this page please contact ",r.a.createElement(ce.a,{href:"mailto:indiebubbler@gmail.com?subject=Feedback"},"indiebubbler@gmail.com"),"."),r.a.createElement("div",null,"Made using ",r.a.createElement(ce.a,{href:"https://reactjs.org/",target:"blank"},"React")," and ",r.a.createElement(ce.a,{href:"https://tonejs.github.io/",target:"blank"},"Tone.js"),"."),r.a.createElement("div",null,"Ideas for visualisation and presets taken from ",r.a.createElement(ce.a,{href:"http://www.ethanhein.com/wp/my-nyu-masters-thesis",target:"blank"},"Ethan Hein's site"),"."),r.a.createElement("div",null,"\xa9 IndieBubbler 2019-2020. Version 2.2"))))),r.a.createElement("div",{ref:"loadMask",className:!0===this.state.showMask?"loadmask ":"loadmask fadeOut"}))}}var ze=Ke;const Le=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Fe(e,t){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const a=e.installing;null!=a&&(a.onstatechange=()=>{"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}i.a.render(r.a.createElement(ze,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="".concat(".","/service-worker.js");Le?(!function(e,t){fetch(e).then(a=>{const s=a.headers.get("content-type");404===a.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Fe(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Fe(t,e)})}}()}},[[109,1,2]]]);
//# sourceMappingURL=main.d670bebc.chunk.js.map